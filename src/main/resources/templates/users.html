<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	<head>

		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto?family=Roboto:wght@900">
		<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
		<link rel="shortcut icon" type="image/png" th:href="@{/img/pharmacy.png}"/>
		
		<title>Benutzer</title>
	</head>
    <body>
		<nav th:include="navigation :: navigation"></nav>
		<div class="center">
			<table class="ui celled table">
				<tr>
					<th>Benutzername</th>
					<th>Rolle</th>
					<th>Arbeitsverhältnis</th>
					<th>Urlaub</th>
					<th>Löschen</th>
				</tr>
				<tr class="ui" th:each="user : ${users}">
					<td th:text="${user.userAccount.getUsername()}">Benutzername</td>
					<td th:if="${user.userAccount.hasRole(boss)}">Geschäftsführer</td>
					<td th:if="${user.userAccount.hasRole(employee)}">Mitarbeiter</td>
					<td th:if="${user.userAccount.hasRole(customer)}">Kunde</td>
					<td>
						<div class="column gap">
							<form th:if="${user.userAccount.hasRole(boss) || user.userAccount.hasRole(employee)}" class="column" method="post" role="form" id="form" th:action="@{/user/{id}/salary(id=${user.getId()})}" th:object="${employeeForm}">
								<label for="name">Gehalt</label>
								<div class="row">
									<input class="numberinput rightcorners" placeholder="420" id="name" name="salary" th:value="${user.getSalary()} ? ${user.getSalary().getNumber()} : ${employeeForm.getSalary()}" th:errorclass="fieldError" type="text" required="required"/>
									<a class="currency rightcorners">€</a>
									<button type="submit" class="leftcorners button">Anpassen</button>
								</div>
								<p class="ui negative message" th:if="${#fields.hasErrors('salary')}" th:errors="*{salary}"></p>
							</form>
							<div th:if="${user.userAccount.hasRole(employee)}" class="field">
								<a class="button" th:href="@{/user/{id}/dismiss(id=${user.getId()})}">Entlassen</a>
							</div>
							<a th:if="${user.userAccount.hasRole(customer)}" class="button" th:href="@{/user/{id}/hire(id=${user.getId()})}">Einstellen</a>
						</div>
					</td>
					<td th:if="${user.userAccount.hasRole(boss)}">
						<p>24/7 Grind</p>
					</td>
					<td th:if="${user.userAccount.hasRole(employee)}">
						<p th:unless="${user.getVacations().size() > 0}">Dieser Mitarbeiter möchte keinen Urlaub nehmen.</p>
						<div th:if="${user.getVacations().size() > 0}" class="field" th:each="index : ${#numbers.sequence(0,(user.getVacations().size() - 1))}" 
						th:object="${user.getVacations()[__${index}__]}">
							<p th:text="*{'Von: '+getStartDate()}"></p>
							<p th:text="*{'Bis: '+getEndDate()}"></p>
							<p th:if="*{getApproved()}" th:text="*{'Dauer: '+getDuration()+' Tage'}"></p>
							<div th:unless="*{getApproved()}">
								<div class="row"><p th:text="*{getDuration()}"></p>/<p th:text="${user.getVacationRemaining()+' Urlaubstagen'}"></p></div>
								<a class="button" th:href="@{/user/{id}/vacation/{vacId}/remove(id=${user.getId()}, vacId=${index})}">Ablehnen</a>
								<a class="button" th:href="@{/user/{id}/vacation/{vacId}/approve(id=${user.getId()}, vacId=${index})}">Genehmigen</a>
							</div>
						</div>
					</td>
					<td th:if="${user.userAccount.hasRole(customer)}">
						<p>Kunden können keinen Urlaub nehmen.</p>
					</td>
					<td>
						<a th:if="${user.userAccount.hasRole(boss)}">Geschäftsführer kann nicht gelöscht werden.</a>
						<a th:if="${user.userAccount.hasRole(employee)}">Mitarbeiter können nicht gelöscht werden.</a>
						<a th:if="${user.userAccount.hasRole(customer)} and ${user.getOrdered()}">Kunde hat bereits Bestellungen.</a>
						<a th:if="${user.userAccount.hasRole(customer)} and not ${user.getOrdered()}" class="iconbutton" th:href="@{/user/{id}/remove(id=${user.getId()})}"><img class="icon" th:src="@{/img/trash.png}"></a>
					</td>
				</tr>
			</table>
		</div>
    </body>
	<script> </script>
</html>